(function(n){n.fn.extend({BlackAndWhite:function(t){"use strict";var f=this,h=this;t=n.extend({hoverEffect:!0,webworkerPath:!1,responsive:!0,invertHoverEffect:!1,speed:500},t);var e=t.hoverEffect,o=t.webworkerPath,i=t.invertHoverEffect,c=t.responsive,r=n.isPlainObject(t.speed)?t.speed.fadeIn:t.speed,u=n.isPlainObject(t.speed)?t.speed.fadeOut:t.speed,l=!!document.createElement("canvas").getContext,a=n(window),v=function(){return typeof Worker!="undefined"?!0:!1}(),y=document.all&&!window.opera&&window.XMLHttpRequest?!0:!1,p=function(n,t,i,r){var e=t.getContext("2d"),a=n,u=0,c,h;e.drawImage(n,0,0,i,r);var s=e.getImageData(0,0,i,r),f=s.data,l=f.length;if(v&&o)h=new Worker(o+"BnWWorker.js"),h.postMessage(s),h.onmessage=function(n){e.putImageData(n.data,0,0)};else{for(;u<l;u+=4)c=f[u]*.3+f[u+1]*.59+f[u+2]*.11,f[u]=f[u+1]=f[u+2]=c;e.putImageData(s,0,0)}},s=function(t,f){var v=t.src,o,c,a;if(l){var y=n(f).find("img").width(),w=n(f).find("img").height(),s=t.width,h=t.height;n('<canvas width="'+s+'" height="'+h+'"><\/canvas>').prependTo(f);o=n(f).find("canvas");n(o).css({position:"absolute",top:0,left:0,width:y,height:w,display:i?"none":"block"});p(t,o[0],s,h);e&&(n(f).mouseenter(function(){i?n(this).find("canvas").stop(!0,!0).fadeIn(r):n(this).find("canvas").stop(!0,!0).fadeOut(u)}),n(f).mouseleave(function(){i?n(this).find("canvas").stop(!0,!0).fadeOut(u):n(this).find("canvas").stop(!0,!0).fadeIn(r)}))}else c=n(f).find("img").prop("width"),a=n(f).find("img").prop("height"),n("<img src="+v+' width="'+c+'" height="'+a+'" class="ieFix" /> ').prependTo(f),n(".ieFix").css({position:"absolute",top:0,left:0,filter:"progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)",display:i?"none":"block"}),e&&(n(f).mouseenter(function(){i?n(this).children(".ieFix").stop(!0,!0).fadeIn(r):n(this).children(".ieFix").stop(!0,!0).fadeOut(u)}),n(f).mouseleave(function(){i?n(this).children(".ieFix").stop(!0,!0).fadeOut(u):n(this).children(".ieFix").stop(!0,!0).fadeIn(r)}))};return this.init=function(){if(n(f).each(function(t,i){var r=new Image;if(r.src=n(i).find("img").prop("src"),r.width)s(r,i);else n(r).on("load",function(){s(r,i)})}),c)a.on("resize orientationchange",f.resizeImages)},this.resizeImages=function(){n(f).each(function(t,i){var r=n(i).find("img:not(.ieFix)"),u,f;y?(u=n(r).prop("width"),f=n(r).prop("height")):(u=n(r).width(),f=n(r).height());n(this).find(".ieFix, canvas").css({width:u,height:f})})},h.init(t)}})})(jQuery);