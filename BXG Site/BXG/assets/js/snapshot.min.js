var gg, categories;
function bvv() {
    $(".inpin")
       .stop().animate({ width: 10, height: 10 }, 700)
       .animate({ width: 20, height: 20 }, 700);
}
function loadCategories() {
    $.ajax({
        type: "GET", url: "news/categories.js", dataType: "json", success: function (data) {
            categories = data.data;
            var i = categories.length, cnt, j, k, html, ohtml, country, cats;
            while (i--) {
                cnt = categories[i];
                j = cnt.country.length;
                html = [];
                ohtml = [];
                ohtml.push("<option value='-1'>Go to market</option>");
                cnt.country.sort(function (a, b) { //inverted
                    if (a.name > b.name)
                        return -1;
                    if (a.name < b.name)
                        return 1;
                    return 0;
                });
                while (j--) {
                    country = cnt.country[j];
                    cats = country.category.split(",").reverse();
                    k = cats.length - 1;
                    html.push("<tr><td class='gray'>" + country.name + "</td><td>" + cats[k] + "</td></tr>");
                    ohtml.push("<option value='" + country.name + "'>" + country.name + "</option>");
                    while (k--) {
                        html.push("<tr><td class='white'>&nbsp;</td><td>" + cats[k] + "</td></tr>");
                    }
                }
                $("#m" + cnt.cnt).html(ohtml.join('')).selecter();
                $("#" + cnt.cnt).find(".details").append(html.join(''));
            }
        }
    });
}
function scrollUp(ths, len) {
    var mdheight = ths.closest(".markets-details").height(),
           top = parseInt(ths.parent().scrollTop());
    ths.parent().animate({ scrollTop: (top <= -len) ? top + len : 0 }, { queue: false });
}
function scrollDown(ths, len) {
    var mdheight = ths.closest(".markets-details").height(),
            top = parseInt(ths.parent().scrollTop()),
            height = ths.height();
    if (!(-1 * top < height - 250 - len)) {
        top = -1 * height + 250 + len;
    }
    ths.parent().animate({ scrollTop: top + len }, { queue: false });
    return false;
}
$(function () {
    gg = setInterval(bvv, 1400);
    loadCategories();
    $(".market-select").change(function () {
        var ths = $(this), market = ths.val(), id = ths.attr("id").replace("m", "t");
        if (market != -1) {
            var table = $("#" + id), offset;
            if (table.data("offset")) {
                offset = table.data("offset");
            } else {
                offset = table.offset().top;
                table.data("offset", offset);
            }
            var tt = table.find(".gray:contains('" + market + "')").offset().top - offset;
            if (tt < 0) {
                scrollUp(table, -1 * tt);
            } else {
                scrollDown(table, tt);
            }
        }
    });
    $(".up").click(function () {
        scrollUp($($(this).attr("href")), 99);
        return false;
    });
    $(".down").click(function () {
        scrollDown($($(this).attr("href")), 99);
        return false;
    });
    $(".upperpin").click(function () {
        var ths = $("#text");
        if (!ths.hasClass("ex")) {
            ths.addClass("ex");
            TweenMax.fromTo(ths, 1, { css: { scale: '1.0' }, immediateRender: true, ease: Quad.easeIn }, {
                css: { scale: '110.0', opacity: 0 },
                ease: Quad.easeIn
            });
        }
        $(".markets-details").hide();
        $(this).next(".markets-details").fadeIn(1500);
    });
    $(".close").click(function () {
        $(".markets-details").fadeOut(800);
        var ths = $("#text");
        ths.removeClass("ex").show();
        TweenMax.fromTo(ths, 1, { css: { scale: '300.0' }, immediateRender: true, ease: Quad.easeIn }, {
            css: { scale: '1.0', opacity: 1 },
            ease: Quad.easeOut
        });
    });
});